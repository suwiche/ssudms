{% load tags %}
<div class="card p-4">
<div class="d-flex justify-content-end mb-3">
   <button class="btn btn-success" onClick="addRecordButton('{{acronym}}')">Add Record</button>
   &nbsp;&nbsp;
   <a class="btn btn-primary cursor-pointer" onClick="generateReportButton('{{filters}}')">Generate Report</a>
</div>
<div class="table-responsive">
   <!--
      <table class="table table-bordered" style="width:100%">
         <thead>
            <tr class="text-center">
               <th>Actions</th>
               <th>Name</th>
               <th>Address</th>
               <th>Status</th>
               <th>Level</th>
               <th>Accreditation No.</th>
               <th>Date Issued</th>
               <th>Date Expiry</th>
            </tr>
         </thead>
         <tbody>
            {% for row in data %}
            <tr>
               <td class="text-center"><a class="cursor-pointer" onClick="viewRecordModal('{{acronym}}', {{row.id}});">View</a></td>
               <td class="text-center">{{row.name}}</td>
               <td class="text-center">{{row.get_address}}</td>
               <td class="text-center">{{ row.get_org_transaction_accreditation.transaction.status.name }}</td>
               <td class="text-center bg-{{row.get_org_transaction_accreditation.transaction.get_color}}">{% if row.get_org_transaction_accreditation %} {{row.get_org_transaction_accreditation.transaction.get_license.level.name}} {% endif %}</td>
               <td class="text-center bg-{{row.get_org_transaction_accreditation.transaction.get_color}}">{% if row.get_org_transaction_accreditation %} {{row.get_org_transaction_accreditation.transaction.get_license.number}} {% endif %}</td>
               <td class="text-center bg-{{row.get_org_transaction_accreditation.transaction.get_color}}">{% if row.get_org_transaction_accreditation %} {{row.get_org_transaction_accreditation.transaction.get_license.date_issued}} {% endif %}</td>
               <td class="text-center bg-{{row.get_org_transaction_accreditation.transaction.get_color}}">{% if row.get_org_transaction_accreditation %} {{row.get_org_transaction_accreditation.transaction.get_license.date_expired}} {% endif %}</td>
            </tr>
            {% endfor %}
         </tbody>
      </table>
   -->
   <table class="table table-bordered" style="width:100%">
      <tr class="text-center">
         <th rowspan="3" style="width: 1%;">Actions</th>
         <th rowspan="3" style="width: 1%;">No</th>
         <th rowspan="3" style="width: 1%;">Name of DCC</th>
         <th rowspan="3" style="width: 1%;">LEVEL</th>
         <th rowspan="3" style="width: 1%;">NAME OF DCW</th>
         <th rowspan="3" style="width: 1%;">LEVEL</th>
         <th rowspan="3" style="width: 1%;">ADDRESS</th>
         <th rowspan="3" style="width: 1%;">PROVINCE</th>
         <th colspan="4" style="width: 1%;">STATUS</th>
         <th rowspan="3" style="width: 1%;">Date Complete Docs. Received</th>
         <th rowspan="3" style="width: 1%;">Date of Assesment</th>
         <th rowspan="3" style="width: 1%;">Date Confirmation</th>
         <th rowspan="3" style="width: 1%;">No. of days acted upon</th>
         <th colspan="3" style="width: 1%;">Certificate of Accreditation (Center)</th>
         <th colspan="3" style="width: 1%;">Certificate of Accreditation (Provider)</th>
      </tr>
      <tr class="text-center">
         <th colspan="2">New</th>
         <th colspan="2">Renewal</th>
         <th rowspan="2" style="width: 1%;">Accreditation No.</th>
         <th rowspan="2" style="width: 1%;">Date Issued</th>
         <th rowspan="2" style="width: 1%;">Expiration Date</th>
         <th rowspan="2" style="width: 1%;">Accreditation No.</th>
         <th rowspan="2" style="width: 1%;">Date Issued</th>
         <th rowspan="2" style="width: 1%;">Expiration Date</th>
      </tr>
      <tr>
         <th>DCW</th>
         <th>DCC</th>
         <th>DCW</th>
         <th>DCC</th>
      </tr>
      <tbody>
      {% for row in data %}
         <tr class="text-center">
            <td rowspan="{{row.get_worker_count}}" class="text-center"><a class="cursor-pointer" onClick="viewRecordModal('{{acronym}}', {{row.id}});">View</a></td>
            <td rowspan="{{row.get_worker_count}}">{{row.id}}</td>
            <td rowspan="{{row.get_worker_count}}">{{row.name}}</td>
            <td rowspan="{{row.get_worker_count}}">{% if row.get_org_transaction_accreditation %} {{row.get_org_transaction_accreditation.transaction.get_license.level.name}} {% endif %}</td>
            <td>{{row.get_first_worker.get_worker_fullname}}</td>
            <td>{{row.get_first_worker.get_worker_transaction_accreditation.transaction.get_license.level.name}}</td>
            <td>{{row.get_first_worker.address}}</td>
            <td>{{row.get_first_worker.province}}</td>
            <td>{% if row.get_first_worker.get_check_if_renewal == 1 %} &#10004; {% endif %}</td>
            <td rowspan="{{row.get_worker_count}}">{% if row.get_check_if_renewal_a == 0 %} &#10004; {% endif %}</td>
            <td>{% if row.get_first_worker.get_check_if_renewal > 1 %} &#10004; {% endif %}</td>
            <td rowspan="{{row.get_worker_count}}">{% if row.get_check_if_renewal_a  >= 1 %} &#10004; {% endif %}</td>
            <td></td>
            <td></td>
            <td></td>
            <td>9</td>
            <td rowspan="{{row.get_worker_count}}">{{row.get_org_transaction_accreditation.transaction.get_license.number}}</td>
            <td rowspan="{{row.get_worker_count}}">{{row.get_org_transaction_accreditation.transaction.get_license.date_issued}}</td>
            <td rowspan="{{row.get_worker_count}}">{{row.get_org_transaction_accreditation.transaction.get_license.date_expired}}</td>
            <td>{{row.get_first_worker.get_worker_transaction_accreditation.transaction.get_license.number}}</td>
            <td>{{row.get_first_worker.get_worker_transaction_accreditation.transaction.get_license.date_issued}}2</td>
            <td>{{row.get_first_worker.get_worker_transaction_accreditation.transaction.get_license.date_expired}}</td>
         </tr>
         {% for i in row.get_all_worker_except_first %}
            <tr class="text-center">
               <td>{{i.get_worker_fullname}}</td>
               <td>{{i.get_worker_transaction_accreditation.transaction.get_license.level.name}}</td>
               <td>{{i.address}}</td>
               <td>{{i.province}}</td>
               <td>{% if i.get_check_if_renewal == 1 %} &#10004; {% endif %}</td>
               <td>{% if i.get_check_if_renewal  > 1 %} &#10004; {% endif %}</td>
               <td></td>
               <td></td>
               <td></td>
               <td>9</td>
               <td>{{i.get_worker_transaction_accreditation.transaction.get_license.number}}</td>
               <td>{{i.get_worker_transaction_accreditation.transaction.get_license.date_issued}}</td>
               <td>{{i.get_worker_transaction_accreditation.transaction.get_license.date_expired}}</td>
            </tr>
         {% endfor %}
      {% endfor %}
      </tbody>
   </table>
   <div class="d-flex justify-content-between">
      <label class="mt-3">{% if data %} Showing {{ data.start_index }} - {{ data.end_index }} of {{ data.paginator.count }} entr{{ data.paginator.count|pluralize:"y,ies" }} {% else %} No entry {% endif %}</label>
      <ul class="pagination pagination-primary mt-2 d-flex justify-content-end">
         <li class="page-item"><a class="page-link {% if not data.has_previous %} disabled {% else %} cursor-pointer {% endif %}" {% if data.has_previous %} hx-get="{% url 'frontend-records' acronym='cdc' action='filter' %}?{{filters}}&page={{ data.previous_page_number }}" hx-trigger="click" hx-target="#records_view" hx-swap="innerHTML" {% endif %}tabindex="-1">Previous</a></li>
         {% for row in data.paginator.page_range %}
         {% if data.number == row %}
         <li class="page-item active"><a style="cursor:pointer" class="page-link" hx-get="{% url 'frontend-records' acronym='cdc' action='filter' %}?{{filters}}&page={{ row }}" hx-trigger="click" hx-target="#records_view" hx-swap="innerHTML">{{row}}</a></li>
         {% elif data.number|add:'-3' and row < data.number|add:'3' %}
         <li class="page-item"><a style="cursor:pointer" class="page-link" hx-get="{% url 'frontend-records' acronym='cdc' action='filter' %}?{{filters}}&page={{ row }}" hx-trigger="click" hx-target="#records_view" hx-swap="innerHTML">{{row}}</a></li>
         {% endif %}
         {% endfor %}
         <li class="page-item"><a class="page-link {% if not data.has_next %} disabled {% else %} cursor-pointer {% endif %}" {% if data.has_next %} hx-get="{% url 'frontend-records' acronym='cdc' action='filter' %}?{{filters}}&page={{ data.next_page_number }}" hx-trigger="click" hx-target="#records_view" hx-swap="innerHTML" {% endif %}>Next</a></li>
      </ul>
   </div>
</div>